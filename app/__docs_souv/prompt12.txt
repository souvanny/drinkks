Pour ce projet flutter, je voudrais que dans VenuesScreen
ref.read(authServiceProvider).signOut d√©connecte aussi de firebase_auth
J'imagine que c'est firebase, en tout cas je voudrais que dans SocielLoginScreen
dans cette parie

    authState.whenData((user) {
      print(user);
      print('--- user ---');

      if (user != null && mounted) {
        print('‚úÖ Utilisateur d√©j√† connect√©, redirection vers /venues');
        context.go('/venues');
      }
    });

user soit null apr√®s le logout et ne redirige pas vers /venues au moment o√π on arrive √† nouveau dans social_login


FICHIERS POUR ANALYSE
=====================
Dossiers analys√©s:
  - flutter_lib/services
  - flutter_lib/providers
  - flutter_lib/features/social_login
  - flutter_lib/features/venues
Extensions: dart, php
Date: 2026-02-21 19:01:32

ARBORESCENCE:
-------------
‚îî‚îÄ‚îÄ üìÅ flutter_lib/
    ‚îú‚îÄ‚îÄ üìÅ features/
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ social_login/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ data/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ datasources/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ social_login_remote_data_source.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ social_login_remote_data_source.g.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ social_login_model.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ social_login_model.freezed.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ social_login_model.g.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ repositories/
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ social_login_repository_impl.dart
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ social_login_repository_impl.g.dart
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ domain/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ entities/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ social_login_entity.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ social_login_entity.freezed.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repositories/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ social_login_repository.dart
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ usecases/
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ get_social_logins_usecase.dart
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ get_social_logins_usecase.g.dart
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ presentation/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÅ controllers/
    ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ social_login_controller.dart
    ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ social_login_controller.g.dart
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÅ screens/
    ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ üìÑ social_login_screen.dart
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ venues/
    ‚îÇ       ‚îú‚îÄ‚îÄ üìÅ data/
    ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ datasources/
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ venues_remote_data_source.dart
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ venues_remote_data_source.g.dart
    ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ venues_model.dart
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ venues_model.freezed.dart
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ venues_model.g.dart
    ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ repositories/
    ‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ venues_repository_impl.dart
    ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ venues_repository_impl.g.dart
    ‚îÇ       ‚îú‚îÄ‚îÄ üìÅ domain/
    ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ entities/
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ venues_entity.dart
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ venues_entity.freezed.dart
    ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repositories/
    ‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ venues_repository.dart
    ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ usecases/
    ‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ get_venuess_usecase.dart
    ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ get_venuess_usecase.g.dart
    ‚îÇ       ‚îî‚îÄ‚îÄ üìÅ presentation/
    ‚îÇ           ‚îú‚îÄ‚îÄ üìÅ controllers/
    ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ venues_controller.dart
    ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ venues_controller.g.dart
    ‚îÇ           ‚îî‚îÄ‚îÄ üìÅ screens/
    ‚îÇ               ‚îî‚îÄ‚îÄ üìÑ venues_screen.dart
    ‚îú‚îÄ‚îÄ üìÅ providers/
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth_provider.dart
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ test_state_notifier.dart
    ‚îî‚îÄ‚îÄ üìÅ services/
        ‚îú‚îÄ‚îÄ üìÑ api_service.dart
        ‚îú‚îÄ‚îÄ üìÑ api_service.g.dart
        ‚îú‚îÄ‚îÄ üìÑ auth_service.dart
        ‚îú‚îÄ‚îÄ üìÑ sfu_service.dart
        ‚îî‚îÄ‚îÄ üìÑ sfu_service.g.dart


CONTENU DES FICHIERS
====================

FICHIER: flutter_lib/features/social_login/data/datasources/social_login_remote_data_source.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:dio/dio.dart';
import '../../../../core/providers/network_providers.dart';
import '../models/social_login_model.dart';

part 'social_login_remote_data_source.g.dart';

abstract class SocialLoginRemoteDataSource {
  Future<List<SocialLoginModel>> fetchSocialLogins();
  Future<SocialLoginModel> fetchSocialLogin(String id);
}

@riverpod
SocialLoginRemoteDataSource socialLoginRemoteDataSource(Ref ref) {
  final dio = ref.watch(dioProvider);
  return SocialLoginRemoteDataSourceImpl(dio);
}

class SocialLoginRemoteDataSourceImpl implements SocialLoginRemoteDataSource {
  final Dio _dio;

  SocialLoginRemoteDataSourceImpl(this._dio);

  @override
  Future<List<SocialLoginModel>> fetchSocialLogins() async {
    // final response = await _dio.get('/social_logins');
    // return (response.data as List).map((e) => SocialLoginModel.fromJson(e)).toList();
    // await Future.delayed(const Duration(seconds: 1));
    // return [
    //   const SocialLoginModel(id: '1', name: 'Item 1'),
    //   const SocialLoginModel(id: '2', name: 'Item 2'),
    // ];
    return [];
  }

  @override
  Future<SocialLoginModel> fetchSocialLogin(String id) async {
    await Future.delayed(const Duration(seconds: 1));
    return SocialLoginModel(id: id, name: 'Item ');
  }
}



FICHIER: flutter_lib/features/social_login/data/datasources/social_login_remote_data_source.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'social_login_remote_data_source.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(socialLoginRemoteDataSource)
final socialLoginRemoteDataSourceProvider =
    SocialLoginRemoteDataSourceProvider._();

final class SocialLoginRemoteDataSourceProvider
    extends
        $FunctionalProvider<
          SocialLoginRemoteDataSource,
          SocialLoginRemoteDataSource,
          SocialLoginRemoteDataSource
        >
    with $Provider<SocialLoginRemoteDataSource> {
  SocialLoginRemoteDataSourceProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'socialLoginRemoteDataSourceProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$socialLoginRemoteDataSourceHash();

  @$internal
  @override
  $ProviderElement<SocialLoginRemoteDataSource> $createElement(
    $ProviderPointer pointer,
  ) => $ProviderElement(pointer);

  @override
  SocialLoginRemoteDataSource create(Ref ref) {
    return socialLoginRemoteDataSource(ref);
  }

  /// {@macro riverpod.override_with_value}
  Override overrideWithValue(SocialLoginRemoteDataSource value) {
    return $ProviderOverride(
      origin: this,
      providerOverride: $SyncValueProvider<SocialLoginRemoteDataSource>(value),
    );
  }
}

String _$socialLoginRemoteDataSourceHash() =>
    r'4c702cae0479e7fb4185f7dc09648f98affcfe75';



FICHIER: flutter_lib/features/social_login/data/models/social_login_model.dart
--------------------------------------------------------------------------------
import 'package:freezed_annotation/freezed_annotation.dart';
import '../../domain/entities/social_login_entity.dart';

part 'social_login_model.freezed.dart';
part 'social_login_model.g.dart';

@freezed
abstract class SocialLoginModel with _$SocialLoginModel {
  const SocialLoginModel._();

  const factory SocialLoginModel({
    required String id,
    required String name,
  }) = _SocialLoginModel;

  factory SocialLoginModel.fromJson(Map<String, dynamic> json) =>
      _$SocialLoginModelFromJson(json);

  SocialLoginEntity toEntity() => SocialLoginEntity(id: id, name: name);
}



FICHIER: flutter_lib/features/social_login/data/models/social_login_model.freezed.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND
// coverage:ignore-file
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'social_login_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

// dart format off
T _$identity<T>(T value) => value;

/// @nodoc
mixin _$SocialLoginModel {

 String get id; String get name;
/// Create a copy of SocialLoginModel
/// with the given fields replaced by the non-null parameter values.
@JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
$SocialLoginModelCopyWith<SocialLoginModel> get copyWith => _$SocialLoginModelCopyWithImpl<SocialLoginModel>(this as SocialLoginModel, _$identity);

  /// Serializes this SocialLoginModel to a JSON map.
  Map<String, dynamic> toJson();


@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is SocialLoginModel&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}

@JsonKey(includeFromJson: false, includeToJson: false)
@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'SocialLoginModel(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class $SocialLoginModelCopyWith<$Res>  {
  factory $SocialLoginModelCopyWith(SocialLoginModel value, $Res Function(SocialLoginModel) _then) = _$SocialLoginModelCopyWithImpl;
@useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class _$SocialLoginModelCopyWithImpl<$Res>
    implements $SocialLoginModelCopyWith<$Res> {
  _$SocialLoginModelCopyWithImpl(this._self, this._then);

  final SocialLoginModel _self;
  final $Res Function(SocialLoginModel) _then;

/// Create a copy of SocialLoginModel
/// with the given fields replaced by the non-null parameter values.
@pragma('vm:prefer-inline') @override $Res call({Object? id = null,Object? name = null,}) {
  return _then(_self.copyWith(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}

}


/// Adds pattern-matching-related methods to [SocialLoginModel].
extension SocialLoginModelPatterns on SocialLoginModel {
/// A variant of `map` that fallback to returning `orElse`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeMap<TResult extends Object?>(TResult Function( _SocialLoginModel value)?  $default,{required TResult orElse(),}){
final _that = this;
switch (_that) {
case _SocialLoginModel() when $default != null:
return $default(_that);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// Callbacks receives the raw object, upcasted.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case final Subclass2 value:
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult map<TResult extends Object?>(TResult Function( _SocialLoginModel value)  $default,){
final _that = this;
switch (_that) {
case _SocialLoginModel():
return $default(_that);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `map` that fallback to returning `null`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? mapOrNull<TResult extends Object?>(TResult? Function( _SocialLoginModel value)?  $default,){
final _that = this;
switch (_that) {
case _SocialLoginModel() when $default != null:
return $default(_that);case _:
  return null;

}
}
/// A variant of `when` that fallback to an `orElse` callback.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeWhen<TResult extends Object?>(TResult Function( String id,  String name)?  $default,{required TResult orElse(),}) {final _that = this;
switch (_that) {
case _SocialLoginModel() when $default != null:
return $default(_that.id,_that.name);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// As opposed to `map`, this offers destructuring.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case Subclass2(:final field2):
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult when<TResult extends Object?>(TResult Function( String id,  String name)  $default,) {final _that = this;
switch (_that) {
case _SocialLoginModel():
return $default(_that.id,_that.name);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `when` that fallback to returning `null`
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? whenOrNull<TResult extends Object?>(TResult? Function( String id,  String name)?  $default,) {final _that = this;
switch (_that) {
case _SocialLoginModel() when $default != null:
return $default(_that.id,_that.name);case _:
  return null;

}
}

}

/// @nodoc
@JsonSerializable()

class _SocialLoginModel extends SocialLoginModel {
  const _SocialLoginModel({required this.id, required this.name}): super._();
  factory _SocialLoginModel.fromJson(Map<String, dynamic> json) => _$SocialLoginModelFromJson(json);

@override final  String id;
@override final  String name;

/// Create a copy of SocialLoginModel
/// with the given fields replaced by the non-null parameter values.
@override @JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
_$SocialLoginModelCopyWith<_SocialLoginModel> get copyWith => __$SocialLoginModelCopyWithImpl<_SocialLoginModel>(this, _$identity);

@override
Map<String, dynamic> toJson() {
  return _$SocialLoginModelToJson(this, );
}

@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is _SocialLoginModel&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}

@JsonKey(includeFromJson: false, includeToJson: false)
@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'SocialLoginModel(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class _$SocialLoginModelCopyWith<$Res> implements $SocialLoginModelCopyWith<$Res> {
  factory _$SocialLoginModelCopyWith(_SocialLoginModel value, $Res Function(_SocialLoginModel) _then) = __$SocialLoginModelCopyWithImpl;
@override @useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class __$SocialLoginModelCopyWithImpl<$Res>
    implements _$SocialLoginModelCopyWith<$Res> {
  __$SocialLoginModelCopyWithImpl(this._self, this._then);

  final _SocialLoginModel _self;
  final $Res Function(_SocialLoginModel) _then;

/// Create a copy of SocialLoginModel
/// with the given fields replaced by the non-null parameter values.
@override @pragma('vm:prefer-inline') $Res call({Object? id = null,Object? name = null,}) {
  return _then(_SocialLoginModel(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}


}

// dart format on



FICHIER: flutter_lib/features/social_login/data/models/social_login_model.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'social_login_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_SocialLoginModel _$SocialLoginModelFromJson(Map<String, dynamic> json) =>
    _SocialLoginModel(id: json['id'] as String, name: json['name'] as String);

Map<String, dynamic> _$SocialLoginModelToJson(_SocialLoginModel instance) =>
    <String, dynamic>{'id': instance.id, 'name': instance.name};



FICHIER: flutter_lib/features/social_login/data/repositories/social_login_repository_impl.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import '../../domain/entities/social_login_entity.dart';
import '../../domain/repositories/social_login_repository.dart';
import '../datasources/social_login_remote_data_source.dart';

part 'social_login_repository_impl.g.dart';

@riverpod
SocialLoginRepository socialLoginRepository(Ref ref) {
  final remoteDataSource = ref.watch(socialLoginRemoteDataSourceProvider);
  return SocialLoginRepositoryImpl(remoteDataSource);
}

class SocialLoginRepositoryImpl implements SocialLoginRepository {
  final SocialLoginRemoteDataSource _remoteDataSource;

  SocialLoginRepositoryImpl(this._remoteDataSource);

  @override
  Future<List<SocialLoginEntity>> getSocialLogins() async {
    final models = await _remoteDataSource.fetchSocialLogins();
    return models.map((e) => e.toEntity()).toList();
  }

  @override
  Future<SocialLoginEntity> getSocialLogin(String id) async {
    final model = await _remoteDataSource.fetchSocialLogin(id);
    return model.toEntity();
  }
}



FICHIER: flutter_lib/features/social_login/data/repositories/social_login_repository_impl.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'social_login_repository_impl.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(socialLoginRepository)
final socialLoginRepositoryProvider = SocialLoginRepositoryProvider._();

final class SocialLoginRepositoryProvider
    extends
        $FunctionalProvider<
          SocialLoginRepository,
          SocialLoginRepository,
          SocialLoginRepository
        >
    with $Provider<SocialLoginRepository> {
  SocialLoginRepositoryProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'socialLoginRepositoryProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$socialLoginRepositoryHash();

  @$internal
  @override
  $ProviderElement<SocialLoginRepository> $createElement(
    $ProviderPointer pointer,
  ) => $ProviderElement(pointer);

  @override
  SocialLoginRepository create(Ref ref) {
    return socialLoginRepository(ref);
  }

  /// {@macro riverpod.override_with_value}
  Override overrideWithValue(SocialLoginRepository value) {
    return $ProviderOverride(
      origin: this,
      providerOverride: $SyncValueProvider<SocialLoginRepository>(value),
    );
  }
}

String _$socialLoginRepositoryHash() =>
    r'245216df254a2f1cbb530b4b7c64b67c6327439c';



FICHIER: flutter_lib/features/social_login/domain/entities/social_login_entity.dart
--------------------------------------------------------------------------------
import 'package:freezed_annotation/freezed_annotation.dart';

part 'social_login_entity.freezed.dart';

@freezed
abstract class SocialLoginEntity with _$SocialLoginEntity {
  const factory SocialLoginEntity({
    required String id,
    required String name,
  }) = _SocialLoginEntity;
}



FICHIER: flutter_lib/features/social_login/domain/entities/social_login_entity.freezed.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND
// coverage:ignore-file
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'social_login_entity.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

// dart format off
T _$identity<T>(T value) => value;
/// @nodoc
mixin _$SocialLoginEntity {

 String get id; String get name;
/// Create a copy of SocialLoginEntity
/// with the given fields replaced by the non-null parameter values.
@JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
$SocialLoginEntityCopyWith<SocialLoginEntity> get copyWith => _$SocialLoginEntityCopyWithImpl<SocialLoginEntity>(this as SocialLoginEntity, _$identity);



@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is SocialLoginEntity&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}


@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'SocialLoginEntity(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class $SocialLoginEntityCopyWith<$Res>  {
  factory $SocialLoginEntityCopyWith(SocialLoginEntity value, $Res Function(SocialLoginEntity) _then) = _$SocialLoginEntityCopyWithImpl;
@useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class _$SocialLoginEntityCopyWithImpl<$Res>
    implements $SocialLoginEntityCopyWith<$Res> {
  _$SocialLoginEntityCopyWithImpl(this._self, this._then);

  final SocialLoginEntity _self;
  final $Res Function(SocialLoginEntity) _then;

/// Create a copy of SocialLoginEntity
/// with the given fields replaced by the non-null parameter values.
@pragma('vm:prefer-inline') @override $Res call({Object? id = null,Object? name = null,}) {
  return _then(_self.copyWith(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}

}


/// Adds pattern-matching-related methods to [SocialLoginEntity].
extension SocialLoginEntityPatterns on SocialLoginEntity {
/// A variant of `map` that fallback to returning `orElse`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeMap<TResult extends Object?>(TResult Function( _SocialLoginEntity value)?  $default,{required TResult orElse(),}){
final _that = this;
switch (_that) {
case _SocialLoginEntity() when $default != null:
return $default(_that);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// Callbacks receives the raw object, upcasted.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case final Subclass2 value:
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult map<TResult extends Object?>(TResult Function( _SocialLoginEntity value)  $default,){
final _that = this;
switch (_that) {
case _SocialLoginEntity():
return $default(_that);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `map` that fallback to returning `null`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? mapOrNull<TResult extends Object?>(TResult? Function( _SocialLoginEntity value)?  $default,){
final _that = this;
switch (_that) {
case _SocialLoginEntity() when $default != null:
return $default(_that);case _:
  return null;

}
}
/// A variant of `when` that fallback to an `orElse` callback.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeWhen<TResult extends Object?>(TResult Function( String id,  String name)?  $default,{required TResult orElse(),}) {final _that = this;
switch (_that) {
case _SocialLoginEntity() when $default != null:
return $default(_that.id,_that.name);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// As opposed to `map`, this offers destructuring.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case Subclass2(:final field2):
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult when<TResult extends Object?>(TResult Function( String id,  String name)  $default,) {final _that = this;
switch (_that) {
case _SocialLoginEntity():
return $default(_that.id,_that.name);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `when` that fallback to returning `null`
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? whenOrNull<TResult extends Object?>(TResult? Function( String id,  String name)?  $default,) {final _that = this;
switch (_that) {
case _SocialLoginEntity() when $default != null:
return $default(_that.id,_that.name);case _:
  return null;

}
}

}

/// @nodoc


class _SocialLoginEntity implements SocialLoginEntity {
  const _SocialLoginEntity({required this.id, required this.name});


@override final  String id;
@override final  String name;

/// Create a copy of SocialLoginEntity
/// with the given fields replaced by the non-null parameter values.
@override @JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
_$SocialLoginEntityCopyWith<_SocialLoginEntity> get copyWith => __$SocialLoginEntityCopyWithImpl<_SocialLoginEntity>(this, _$identity);



@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is _SocialLoginEntity&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}


@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'SocialLoginEntity(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class _$SocialLoginEntityCopyWith<$Res> implements $SocialLoginEntityCopyWith<$Res> {
  factory _$SocialLoginEntityCopyWith(_SocialLoginEntity value, $Res Function(_SocialLoginEntity) _then) = __$SocialLoginEntityCopyWithImpl;
@override @useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class __$SocialLoginEntityCopyWithImpl<$Res>
    implements _$SocialLoginEntityCopyWith<$Res> {
  __$SocialLoginEntityCopyWithImpl(this._self, this._then);

  final _SocialLoginEntity _self;
  final $Res Function(_SocialLoginEntity) _then;

/// Create a copy of SocialLoginEntity
/// with the given fields replaced by the non-null parameter values.
@override @pragma('vm:prefer-inline') $Res call({Object? id = null,Object? name = null,}) {
  return _then(_SocialLoginEntity(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}


}

// dart format on



FICHIER: flutter_lib/features/social_login/domain/repositories/social_login_repository.dart
--------------------------------------------------------------------------------
import '../entities/social_login_entity.dart';

abstract class SocialLoginRepository {
  Future<List<SocialLoginEntity>> getSocialLogins();
  Future<SocialLoginEntity> getSocialLogin(String id);
}



FICHIER: flutter_lib/features/social_login/domain/usecases/get_social_logins_usecase.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import '../entities/social_login_entity.dart';
import '../repositories/social_login_repository.dart';
import '../../data/repositories/social_login_repository_impl.dart';

part 'get_social_logins_usecase.g.dart';

@riverpod
Future<List<SocialLoginEntity>> getSocialLogins(Ref ref) {
  return ref.watch(socialLoginRepositoryProvider).getSocialLogins();
}



FICHIER: flutter_lib/features/social_login/domain/usecases/get_social_logins_usecase.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'get_social_logins_usecase.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(getSocialLogins)
final getSocialLoginsProvider = GetSocialLoginsProvider._();

final class GetSocialLoginsProvider
    extends
        $FunctionalProvider<
          AsyncValue<List<SocialLoginEntity>>,
          List<SocialLoginEntity>,
          FutureOr<List<SocialLoginEntity>>
        >
    with
        $FutureModifier<List<SocialLoginEntity>>,
        $FutureProvider<List<SocialLoginEntity>> {
  GetSocialLoginsProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'getSocialLoginsProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$getSocialLoginsHash();

  @$internal
  @override
  $FutureProviderElement<List<SocialLoginEntity>> $createElement(
    $ProviderPointer pointer,
  ) => $FutureProviderElement(pointer);

  @override
  FutureOr<List<SocialLoginEntity>> create(Ref ref) {
    return getSocialLogins(ref);
  }
}

String _$getSocialLoginsHash() => r'3520f25d6ac3be09c359e09715135a2f6577795e';



FICHIER: flutter_lib/features/social_login/presentation/controllers/social_login_controller.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:firebase_auth/firebase_auth.dart';
import '../../../../providers/auth_provider.dart';
import '../../domain/entities/social_login_entity.dart';
import '../../domain/usecases/get_social_logins_usecase.dart';
import '../../../../services/auth_service.dart';

part 'social_login_controller.g.dart';

@riverpod
class SocialLoginController extends _$SocialLoginController {
  late AuthService _authService;

  @override
  FutureOr<List<SocialLoginEntity>> build() {
    _authService = ref.read(authServiceProvider);

    print('üü° SocialLoginController initialis√©');
    return ref.watch(getSocialLoginsProvider.future);
  }

  Future<void> refresh() async {
    state = const AsyncValue.loading();
    state = await AsyncValue.guard(() => ref.refresh(getSocialLoginsProvider.future));
  }

  Future<void> handleGoogleAuthenticationEvent() async {
  }

  Future<void> handleGoogleAuthenticationError() async {
  }



    // NOUVELLE M√âTHODE : Connexion avec Google
  Future<User?> signInWithGoogle() async {
    print('üîµ SocialLoginController.signInWithGoogle() appel√©');

    try {
      // Appeler le service d'authentification
      await _authService.signInWithGoogle();
    } catch (e, stack) {
      print('‚ùå Erreur dans signInWithGoogle: $e');
      print('Stack trace: $stack');
      rethrow;
    }
  }

  // M√©thode de d√©connexion
  Future<void> signOut() async {
    try {
      await _authService.signOut();
      print('‚úÖ D√©connexion effectu√©e depuis SocialLoginController');
    } catch (e) {
      print('‚ùå Erreur lors de la d√©connexion: $e');
      rethrow;
    }
  }
}



FICHIER: flutter_lib/features/social_login/presentation/controllers/social_login_controller.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'social_login_controller.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(SocialLoginController)
final socialLoginControllerProvider = SocialLoginControllerProvider._();

final class SocialLoginControllerProvider
    extends
        $AsyncNotifierProvider<SocialLoginController, List<SocialLoginEntity>> {
  SocialLoginControllerProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'socialLoginControllerProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$socialLoginControllerHash();

  @$internal
  @override
  SocialLoginController create() => SocialLoginController();
}

String _$socialLoginControllerHash() =>
    r'e3178f3ea74973899bbe78ccffb397d264b46adf';

abstract class _$SocialLoginController
    extends $AsyncNotifier<List<SocialLoginEntity>> {
  FutureOr<List<SocialLoginEntity>> build();
  @$mustCallSuper
  @override
  void runBuild() {
    final ref =
        this.ref
            as $Ref<
              AsyncValue<List<SocialLoginEntity>>,
              List<SocialLoginEntity>
            >;
    final element =
        ref.element
            as $ClassProviderElement<
              AnyNotifier<
                AsyncValue<List<SocialLoginEntity>>,
                List<SocialLoginEntity>
              >,
              AsyncValue<List<SocialLoginEntity>>,
              Object?,
              Object?
            >;
    element.handleCreate(ref, build);
  }
}



FICHIER: flutter_lib/features/social_login/presentation/screens/social_login_screen.dart
--------------------------------------------------------------------------------
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:go_router/go_router.dart';
import '../../../../providers/auth_provider.dart';
import '../../domain/entities/social_login_entity.dart';
import '../controllers/social_login_controller.dart';

class SocialLoginScreen extends ConsumerStatefulWidget {
  const SocialLoginScreen({super.key});

  @override
  ConsumerState<SocialLoginScreen> createState() => _SocialLoginScreenState();
}

class _SocialLoginScreenState extends ConsumerState<SocialLoginScreen> {
  bool _isGoogleSigningIn = false;
  String? _errorMessage;
  bool _showMethods = false;

  Future<void> _signInWithGoogle() async {
    if (_isGoogleSigningIn) return;

    setState(() {
      _isGoogleSigningIn = true;
      _errorMessage = null;
    });

    try {
      print('üîµ D√©but de la connexion Google...');
      await ref.read(socialLoginControllerProvider.notifier).signInWithGoogle();
    } catch (e) {
      print('‚ùå Erreur Google Sign-In: $e');
      if (mounted) {
        setState(() {
          _errorMessage = _getUserFriendlyError(e);
        });
        _showErrorSnackbar(e);
      }
    } finally {
      if (mounted) {
        setState(() {
          _isGoogleSigningIn = false;
        });
      }
    }
  }

  String _getUserFriendlyError(dynamic error) {
    if (error is FirebaseAuthException) {
      switch (error.code) {
        case 'popup-closed-by-user':
          return 'Connexion annul√©e';
        case 'network-request-failed':
          return 'Erreur r√©seau. V√©rifiez votre connexion';
        default:
          return 'Erreur: ${error.message ?? error.code}';
      }
    }
    return 'Erreur de connexion. Veuillez r√©essayer.';
  }

  void _showErrorSnackbar(dynamic error) {
    if (!mounted) return;
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(_getUserFriendlyError(error)),
        backgroundColor: Colors.red,
        duration: const Duration(seconds: 3),
        behavior: SnackBarBehavior.floating,
      ),
    );
  }

  @override
  void initState() {
    super.initState();
    // CORRECTION: Utiliser WidgetsBinding.instance.addPostFrameCallback avec un mounted check
    WidgetsBinding.instance.addPostFrameCallback((_) {
      if (mounted) {
        _checkAuthenticationState();
      }
    });
  }

  void _checkAuthenticationState() {
    if (!mounted) return;

    // CORRECTION: Sauvegarder la r√©f√©rence √† ref dans une variable locale
    final localRef = ref;
    final authState = localRef.read(authStateProvider);

    authState.whenData((user) {
      print(user);
      print('--- user ---');

      if (user != null && mounted) {
        print('‚úÖ Utilisateur d√©j√† connect√©, redirection vers /venues');
        context.go('/venues');
      }
    });
  }

  @override
  Widget build(BuildContext context) {
    final socialLoginState = ref.watch(socialLoginControllerProvider);

    // CORRECTION: Utiliser ref.listen avec mounted check
    ref.listen(authStateNotifierProvider, (previous, next) {
      if (!mounted) return;

      if (next.isFullyAuthenticated) {
        // Redirection uniquement quand Firebase ET JWT sont OK
        context.go('/venues');
      } else if (next.hasError) {
        // G√©rer l'erreur
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Erreur: ${next.error}')),
        );
      }
    });

    // Palette de couleurs pour l'ambiance Drinkks
    const primaryColor = Color(0xFF6366F1); // Indigo doux
    const backgroundColor = Color(0xFF0F0F23); // Noir bleut√© profond
    const surfaceColor = Color(0xFF1A1A2E); // Surface l√©g√®rement plus claire
    const accentColor = Color(0xFF8B5CF6); // Violet accent
    const textPrimary = Colors.white;
    const textSecondary = Color(0xFF94A3B8); // Gris bleut√©

    return Scaffold(
      backgroundColor: backgroundColor,
      body: SafeArea(
        child: SingleChildScrollView(
          physics: const BouncingScrollPhysics(),
          child: Padding(
            padding: const EdgeInsets.all(24.0),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              crossAxisAlignment: CrossAxisAlignment.stretch,
              children: [
                // Espace en haut
                const SizedBox(height: 40),

                // Logo et nom d'application anim√©
                _buildLogoHeader(primaryColor, accentColor),

                // Espacement
                const SizedBox(height: 48),

                // Message d'accueil
                _buildWelcomeText(textPrimary, textSecondary),

                // Espacement
                const SizedBox(height: 48),

                // Bouton Google principal
                _buildGoogleSignInButton(primaryColor, textPrimary),

                // Message d'erreur
                if (_errorMessage != null) ...[
                  const SizedBox(height: 20),
                  _buildErrorMessage(_errorMessage!, accentColor),
                ],

                // S√©parateur √©l√©gant
                const SizedBox(height: 40),
                _buildDivider(textSecondary),

                // Bouton pour voir les autres m√©thodes
                if (!_showMethods) ...[
                  const SizedBox(height: 24),
                  _buildShowMethodsButton(textSecondary, accentColor),
                ],

                // Liste des autres m√©thodes
                if (_showMethods)
                  _buildOtherMethodsSection(
                    socialLoginState,
                    surfaceColor,
                    textPrimary,
                    textSecondary,
                    accentColor,
                  ),

                // Conditions d'utilisation
                const SizedBox(height: 40),
                _buildTermsAndPrivacy(textSecondary),
              ],
            ),
          ),
        ),
      ),
    );
  }


  Widget _buildLogoHeader(Color primaryColor, Color accentColor) {
    return Column(
      children: [
        // Logo anim√© (cercle avec effet de vague) - CLIQUEZ ICI !
        InkWell(
          onTap: () {
            // Navigation temporaire vers /venues
            print('üé¨ Clic sur logo - Acc√®s temporaire √† /venues');
            context.go('/venues');
          },
          borderRadius: BorderRadius.circular(60),
          child: Container(
            width: 120,
            height: 120,
            decoration: BoxDecoration(
              gradient: RadialGradient(
                colors: [
                  primaryColor.withOpacity(0.3),
                  primaryColor.withOpacity(0.1),
                  Colors.transparent,
                ],
                stops: const [0.1, 0.5, 1.0],
              ),
            ),
            child: Stack(
              alignment: Alignment.center,
              children: [
                // Effet de vague ext√©rieur
                Container(
                  width: 100,
                  height: 100,
                  decoration: BoxDecoration(
                    shape: BoxShape.circle,
                    border: Border.all(
                      color: primaryColor.withOpacity(0.3),
                      width: 2,
                    ),
                  ),
                ),

                // Cercle int√©rieur avec ic√¥ne
                Container(
                  width: 80,
                  height: 80,
                  decoration: BoxDecoration(
                    gradient: LinearGradient(
                      begin: Alignment.topLeft,
                      end: Alignment.bottomRight,
                      colors: [
                        primaryColor,
                        accentColor,
                      ],
                    ),
                    shape: BoxShape.circle,
                    boxShadow: [
                      BoxShadow(
                        color: primaryColor.withOpacity(0.4),
                        blurRadius: 20,
                        spreadRadius: 2,
                      ),
                    ],
                  ),
                  child: const Icon(
                    Icons.videocam,
                    size: 40,
                    color: Colors.white,
                  ),
                ),
              ],
            ),
          ),
        ),

        const SizedBox(height: 20),

        // Nom de l'application avec effet de gradient
        ShaderMask(
          shaderCallback: (bounds) {
            return LinearGradient(
              begin: Alignment.centerLeft,
              end: Alignment.centerRight,
              colors: [primaryColor, accentColor],
            ).createShader(bounds);
          },
          child: Text(
            'Drinkks',
            style: TextStyle(
              fontSize: 42,
              fontWeight: FontWeight.w800,
              letterSpacing: 1.5,
              color: Colors.white,
            ),
          ),
        ),

        // Tagline
        const SizedBox(height: 8),
        Text(
          'Visio ‚Ä¢ Social ‚Ä¢ Instantan√©',
          style: TextStyle(
            fontSize: 14,
            color: Colors.white.withOpacity(0.7),
            letterSpacing: 1.2,
          ),
        ),
      ],
    );
  }

  Widget _buildWelcomeText(Color textPrimary, Color textSecondary) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          'Rejoignez la conversation',
          style: TextStyle(
            fontSize: 32,
            fontWeight: FontWeight.w700,
            color: textPrimary,
            height: 1.2,
          ),
        ),

        const SizedBox(height: 12),

        RichText(
          text: TextSpan(
            children: [
              TextSpan(
                text: 'Prenez place √† une table virtuelle, ',
                style: TextStyle(
                  fontSize: 16,
                  color: textSecondary,
                  height: 1.5,
                ),
              ),
              TextSpan(
                text: 'discutez en visio',
                style: TextStyle(
                  fontSize: 16,
                  color: Colors.white,
                  fontWeight: FontWeight.w600,
                  height: 1.5,
                ),
              ),
              TextSpan(
                text: ' et cr√©ez des connexions authentiques.',
                style: TextStyle(
                  fontSize: 16,
                  color: textSecondary,
                  height: 1.5,
                ),
              ),
            ],
          ),
        ),
      ],
    );
  }

  Widget _buildGoogleSignInButton(Color primaryColor, Color textPrimary) {
    return AnimatedContainer(
      duration: const Duration(milliseconds: 300),
      decoration: BoxDecoration(
        borderRadius: BorderRadius.circular(16),
        gradient: _isGoogleSigningIn
            ? null
            : LinearGradient(
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
          colors: [
            primaryColor,
            const Color(0xFF8B5CF6),
          ],
        ),
        boxShadow: _isGoogleSigningIn
            ? []
            : [
          BoxShadow(
            color: primaryColor.withOpacity(0.3),
            blurRadius: 20,
            offset: const Offset(0, 8),
          ),
        ],
      ),
      child: Material(
        color: Colors.transparent,
        borderRadius: BorderRadius.circular(16),
        child: InkWell(
          onTap: _isGoogleSigningIn ? null : _signInWithGoogle,
          borderRadius: BorderRadius.circular(16),
          child: Container(
            width: double.infinity,
            height: 60,
            padding: const EdgeInsets.symmetric(horizontal: 24),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: _isGoogleSigningIn
                  ? [
                SizedBox(
                  width: 24,
                  height: 24,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    color: textPrimary,
                  ),
                ),
                const SizedBox(width: 16),
                Text(
                  'Connexion en cours...',
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w600,
                    color: textPrimary,
                  ),
                ),
              ]
                  : [
                Image.asset(
                  'assets/images/logos/google-signin-logo_100_100.png',
                  height: 24,
                  width: 24,
                  errorBuilder: (context, error, stackTrace) {
                    return Icon(
                      Icons.g_mobiledata,
                      size: 24,
                      color: textPrimary,
                    );
                  },
                ),
                const SizedBox(width: 16),
                Text(
                  'Continuer avec Google',
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w600,
                    color: textPrimary,
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Widget _buildErrorMessage(String message, Color accentColor) {
    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: accentColor.withOpacity(0.1),
        borderRadius: BorderRadius.circular(12),
        border: Border.all(color: accentColor.withOpacity(0.3)),
      ),
      child: Row(
        children: [
          Icon(
            Icons.info_outline,
            color: accentColor,
            size: 20,
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Text(
              message,
              style: TextStyle(
                color: Colors.white,
                fontSize: 14,
              ),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildDivider(Color textSecondary) {
    return Row(
      children: [
        Expanded(
          child: Divider(
            color: textSecondary.withOpacity(0.3),
            thickness: 1,
          ),
        ),
        Padding(
          padding: const EdgeInsets.symmetric(horizontal: 16),
          child: Text(
            'ou',
            style: TextStyle(
              color: textSecondary,
              fontSize: 14,
            ),
          ),
        ),
        Expanded(
          child: Divider(
            color: textSecondary.withOpacity(0.3),
            thickness: 1,
          ),
        ),
      ],
    );
  }

  Widget _buildShowMethodsButton(Color textSecondary, Color accentColor) {
    return TextButton(
      onPressed: () {
        setState(() {
          _showMethods = true;
        });
      },
      style: TextButton.styleFrom(
        foregroundColor: accentColor,
      ),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Text(
            'Autres m√©thodes de connexion',
            style: TextStyle(
              color: textSecondary,
              fontSize: 14,
            ),
          ),
          const SizedBox(width: 8),
          Icon(
            Icons.arrow_forward,
            size: 16,
            color: textSecondary,
          ),
        ],
      ),
    );
  }

  Widget _buildOtherMethodsSection(
      AsyncValue<List<SocialLoginEntity>> socialLoginState,
      Color surfaceColor,
      Color textPrimary,
      Color textSecondary,
      Color accentColor,
      ) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const SizedBox(height: 32),
        Text(
          'Bient√¥t disponible',
          style: TextStyle(
            fontSize: 18,
            fontWeight: FontWeight.w600,
            color: textPrimary,
          ),
        ),
        const SizedBox(height: 8),
        Text(
          'Nous travaillons √† ajouter d\'autres options de connexion',
          style: TextStyle(
            fontSize: 14,
            color: textSecondary,
          ),
        ),
        const SizedBox(height: 24),
        socialLoginState.when(
          data: (socialLogins) {
            final otherMethods = socialLogins
                .where((method) => method.id.toLowerCase() != 'google')
                .toList();

            if (otherMethods.isEmpty) {
              return Padding(
                padding: const EdgeInsets.all(16.0),
                child: Text(
                  'Plus d\'options arrivent bient√¥t...',
                  textAlign: TextAlign.center,
                  style: TextStyle(
                    color: textSecondary,
                    fontStyle: FontStyle.italic,
                  ),
                ),
              );
            }

            return Column(
              children: otherMethods.map((method) {
                return Container(
                  margin: const EdgeInsets.only(bottom: 12),
                  decoration: BoxDecoration(
                    color: surfaceColor,
                    borderRadius: BorderRadius.circular(16),
                    border: Border.all(
                      color: Colors.white.withOpacity(0.05),
                    ),
                  ),
                  child: ListTile(
                    leading: Container(
                      width: 44,
                      height: 44,
                      decoration: BoxDecoration(
                        color: _getColorForMethod(method.id).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      ),
                      child: Icon(
                        _getIconForMethod(method.id),
                        color: _getColorForMethod(method.id),
                        size: 22,
                      ),
                    ),
                    title: Text(
                      method.name,
                      style: TextStyle(
                        color: textPrimary,
                        fontWeight: FontWeight.w500,
                      ),
                    ),
                    subtitle: Text(
                      'Disponible prochainement',
                      style: TextStyle(
                        color: textSecondary,
                        fontSize: 12,
                      ),
                    ),
                    trailing: Container(
                      padding: const EdgeInsets.symmetric(
                        horizontal: 12,
                        vertical: 6,
                      ),
                      decoration: BoxDecoration(
                        color: accentColor.withOpacity(0.1),
                        borderRadius: BorderRadius.circular(20),
                        border: Border.all(
                          color: accentColor.withOpacity(0.3),
                        ),
                      ),
                      child: Text(
                        'Bient√¥t',
                        style: TextStyle(
                          color: accentColor,
                          fontSize: 12,
                          fontWeight: FontWeight.w600,
                        ),
                      ),
                    ),
                    onTap: () {
                      _showComingSoonSnackbar(method.name);
                    },
                  ),
                );
              }).toList(),
            );
          },
          loading: () => Center(
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: CircularProgressIndicator(
                color: accentColor,
              ),
            ),
          ),
          error: (err, stack) => Container(
            padding: const EdgeInsets.all(16),
            decoration: BoxDecoration(
              color: surfaceColor,
              borderRadius: BorderRadius.circular(16),
              border: Border.all(
                color: Colors.orange.withOpacity(0.3),
              ),
            ),
            child: Column(
              children: [
                Icon(
                  Icons.warning_amber_rounded,
                  color: Colors.orange,
                  size: 32,
                ),
                const SizedBox(height: 12),
                Text(
                  'Impossible de charger les autres m√©thodes',
                  style: TextStyle(
                    color: Colors.orange,
                    fontWeight: FontWeight.w500,
                  ),
                  textAlign: TextAlign.center,
                ),
              ],
            ),
          ),
        ),
      ],
    );
  }

  Widget _buildTermsAndPrivacy(Color textSecondary) {
    return Column(
      children: [
        Text(
          'En vous connectant, vous acceptez nos',
          style: TextStyle(
            color: textSecondary,
            fontSize: 12,
          ),
        ),
        const SizedBox(height: 4),
        Row(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            TextButton(
              onPressed: () {
                // TODO: Naviguer vers les CGU
              },
              style: TextButton.styleFrom(
                padding: EdgeInsets.zero,
                minimumSize: Size.zero,
                tapTargetSize: MaterialTapTargetSize.shrinkWrap,
              ),
              child: Text(
                'Conditions d\'utilisation',
                style: TextStyle(
                  color: textSecondary.withOpacity(0.8),
                  fontSize: 12,
                  decoration: TextDecoration.underline,
                ),
              ),
            ),
            Text(
              ' et ',
              style: TextStyle(
                color: textSecondary,
                fontSize: 12,
              ),
            ),
            TextButton(
              onPressed: () {
                // TODO: Naviguer vers la politique de confidentialit√©
              },
              style: TextButton.styleFrom(
                padding: EdgeInsets.zero,
                minimumSize: Size.zero,
                tapTargetSize: MaterialTapTargetSize.shrinkWrap,
              ),
              child: Text(
                'Politique de confidentialit√©',
                style: TextStyle(
                  color: textSecondary.withOpacity(0.8),
                  fontSize: 12,
                  decoration: TextDecoration.underline,
                ),
              ),
            ),
          ],
        ),
      ],
    );
  }

  void _showComingSoonSnackbar(String methodName) {
    if (!mounted) return;
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Row(
          children: [
            Icon(
              Icons.schedule,
              color: Colors.white,
              size: 20,
            ),
            const SizedBox(width: 8),
            Text(
              '$methodName sera disponible prochainement !',
              style: const TextStyle(color: Colors.white),
            ),
          ],
        ),
        backgroundColor: const Color(0xFF8B5CF6),
        duration: const Duration(seconds: 2),
        behavior: SnackBarBehavior.floating,
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(12),
        ),
      ),
    );
  }

  // Helper methods
  IconData _getIconForMethod(String methodId) {
    switch (methodId.toLowerCase()) {
      case 'google':
        return Icons.g_mobiledata;
      case 'apple':
        return Icons.apple;
      case 'facebook':
        return Icons.facebook;
      case 'twitter':
        return Icons.flutter_dash;
      case 'email':
        return Icons.email;
      case 'phone':
        return Icons.phone;
      default:
        return Icons.login;
    }
  }

  Color _getColorForMethod(String methodId) {
    switch (methodId.toLowerCase()) {
      case 'google':
        return const Color(0xFFEA4335);
      case 'apple':
        return Colors.white;
      case 'facebook':
        return const Color(0xFF1877F2);
      case 'twitter':
        return Colors.lightBlue;
      case 'email':
        return Colors.green;
      case 'phone':
        return Colors.purple;
      default:
        return const Color(0xFF8B5CF6);
    }
  }
}


FICHIER: flutter_lib/features/venues/data/datasources/venues_remote_data_source.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:dio/dio.dart';
import '../../../../core/providers/network_providers.dart';
import '../models/venues_model.dart';

part 'venues_remote_data_source.g.dart';

abstract class VenuesRemoteDataSource {
  Future<List<VenuesModel>> fetchVenuess();
  Future<VenuesModel> fetchVenues(String id);
}

@riverpod
VenuesRemoteDataSource venuesRemoteDataSource(Ref ref) {
  final dio = ref.watch(dioProvider);
  return VenuesRemoteDataSourceImpl(dio);
}

class VenuesRemoteDataSourceImpl implements VenuesRemoteDataSource {
  final Dio _dio;

  VenuesRemoteDataSourceImpl(this._dio);

  @override
  Future<List<VenuesModel>> fetchVenuess() async {
    // final response = await _dio.get('/venuess');
    // return (response.data as List).map((e) => VenuesModel.fromJson(e)).toList();
    await Future.delayed(const Duration(seconds: 1));
    return [
      const VenuesModel(id: '1', name: 'Item 1'),
      const VenuesModel(id: '2', name: 'Item 2'),
    ];
  }

  @override
  Future<VenuesModel> fetchVenues(String id) async {
    await Future.delayed(const Duration(seconds: 1));
    return VenuesModel(id: id, name: 'Item ');
  }
}



FICHIER: flutter_lib/features/venues/data/datasources/venues_remote_data_source.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'venues_remote_data_source.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(venuesRemoteDataSource)
final venuesRemoteDataSourceProvider = VenuesRemoteDataSourceProvider._();

final class VenuesRemoteDataSourceProvider
    extends
        $FunctionalProvider<
          VenuesRemoteDataSource,
          VenuesRemoteDataSource,
          VenuesRemoteDataSource
        >
    with $Provider<VenuesRemoteDataSource> {
  VenuesRemoteDataSourceProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'venuesRemoteDataSourceProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$venuesRemoteDataSourceHash();

  @$internal
  @override
  $ProviderElement<VenuesRemoteDataSource> $createElement(
    $ProviderPointer pointer,
  ) => $ProviderElement(pointer);

  @override
  VenuesRemoteDataSource create(Ref ref) {
    return venuesRemoteDataSource(ref);
  }

  /// {@macro riverpod.override_with_value}
  Override overrideWithValue(VenuesRemoteDataSource value) {
    return $ProviderOverride(
      origin: this,
      providerOverride: $SyncValueProvider<VenuesRemoteDataSource>(value),
    );
  }
}

String _$venuesRemoteDataSourceHash() =>
    r'e3f50d7bfca91f1f7daddcf90adeb4190d66dc72';



FICHIER: flutter_lib/features/venues/data/models/venues_model.dart
--------------------------------------------------------------------------------
import 'package:freezed_annotation/freezed_annotation.dart';
import '../../domain/entities/venues_entity.dart';

part 'venues_model.freezed.dart';
part 'venues_model.g.dart';

@freezed
abstract class VenuesModel with _$VenuesModel {
  const VenuesModel._();

  const factory VenuesModel({
    required String id,
    required String name,
  }) = _VenuesModel;

  factory VenuesModel.fromJson(Map<String, dynamic> json) =>
      _$VenuesModelFromJson(json);

  VenuesEntity toEntity() => VenuesEntity(id: id, name: name);
}



FICHIER: flutter_lib/features/venues/data/models/venues_model.freezed.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND
// coverage:ignore-file
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'venues_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

// dart format off
T _$identity<T>(T value) => value;

/// @nodoc
mixin _$VenuesModel {

 String get id; String get name;
/// Create a copy of VenuesModel
/// with the given fields replaced by the non-null parameter values.
@JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
$VenuesModelCopyWith<VenuesModel> get copyWith => _$VenuesModelCopyWithImpl<VenuesModel>(this as VenuesModel, _$identity);

  /// Serializes this VenuesModel to a JSON map.
  Map<String, dynamic> toJson();


@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is VenuesModel&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}

@JsonKey(includeFromJson: false, includeToJson: false)
@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'VenuesModel(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class $VenuesModelCopyWith<$Res>  {
  factory $VenuesModelCopyWith(VenuesModel value, $Res Function(VenuesModel) _then) = _$VenuesModelCopyWithImpl;
@useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class _$VenuesModelCopyWithImpl<$Res>
    implements $VenuesModelCopyWith<$Res> {
  _$VenuesModelCopyWithImpl(this._self, this._then);

  final VenuesModel _self;
  final $Res Function(VenuesModel) _then;

/// Create a copy of VenuesModel
/// with the given fields replaced by the non-null parameter values.
@pragma('vm:prefer-inline') @override $Res call({Object? id = null,Object? name = null,}) {
  return _then(_self.copyWith(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}

}


/// Adds pattern-matching-related methods to [VenuesModel].
extension VenuesModelPatterns on VenuesModel {
/// A variant of `map` that fallback to returning `orElse`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeMap<TResult extends Object?>(TResult Function( _VenuesModel value)?  $default,{required TResult orElse(),}){
final _that = this;
switch (_that) {
case _VenuesModel() when $default != null:
return $default(_that);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// Callbacks receives the raw object, upcasted.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case final Subclass2 value:
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult map<TResult extends Object?>(TResult Function( _VenuesModel value)  $default,){
final _that = this;
switch (_that) {
case _VenuesModel():
return $default(_that);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `map` that fallback to returning `null`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? mapOrNull<TResult extends Object?>(TResult? Function( _VenuesModel value)?  $default,){
final _that = this;
switch (_that) {
case _VenuesModel() when $default != null:
return $default(_that);case _:
  return null;

}
}
/// A variant of `when` that fallback to an `orElse` callback.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeWhen<TResult extends Object?>(TResult Function( String id,  String name)?  $default,{required TResult orElse(),}) {final _that = this;
switch (_that) {
case _VenuesModel() when $default != null:
return $default(_that.id,_that.name);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// As opposed to `map`, this offers destructuring.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case Subclass2(:final field2):
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult when<TResult extends Object?>(TResult Function( String id,  String name)  $default,) {final _that = this;
switch (_that) {
case _VenuesModel():
return $default(_that.id,_that.name);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `when` that fallback to returning `null`
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? whenOrNull<TResult extends Object?>(TResult? Function( String id,  String name)?  $default,) {final _that = this;
switch (_that) {
case _VenuesModel() when $default != null:
return $default(_that.id,_that.name);case _:
  return null;

}
}

}

/// @nodoc
@JsonSerializable()

class _VenuesModel extends VenuesModel {
  const _VenuesModel({required this.id, required this.name}): super._();
  factory _VenuesModel.fromJson(Map<String, dynamic> json) => _$VenuesModelFromJson(json);

@override final  String id;
@override final  String name;

/// Create a copy of VenuesModel
/// with the given fields replaced by the non-null parameter values.
@override @JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
_$VenuesModelCopyWith<_VenuesModel> get copyWith => __$VenuesModelCopyWithImpl<_VenuesModel>(this, _$identity);

@override
Map<String, dynamic> toJson() {
  return _$VenuesModelToJson(this, );
}

@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is _VenuesModel&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}

@JsonKey(includeFromJson: false, includeToJson: false)
@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'VenuesModel(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class _$VenuesModelCopyWith<$Res> implements $VenuesModelCopyWith<$Res> {
  factory _$VenuesModelCopyWith(_VenuesModel value, $Res Function(_VenuesModel) _then) = __$VenuesModelCopyWithImpl;
@override @useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class __$VenuesModelCopyWithImpl<$Res>
    implements _$VenuesModelCopyWith<$Res> {
  __$VenuesModelCopyWithImpl(this._self, this._then);

  final _VenuesModel _self;
  final $Res Function(_VenuesModel) _then;

/// Create a copy of VenuesModel
/// with the given fields replaced by the non-null parameter values.
@override @pragma('vm:prefer-inline') $Res call({Object? id = null,Object? name = null,}) {
  return _then(_VenuesModel(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}


}

// dart format on



FICHIER: flutter_lib/features/venues/data/models/venues_model.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'venues_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_VenuesModel _$VenuesModelFromJson(Map<String, dynamic> json) =>
    _VenuesModel(id: json['id'] as String, name: json['name'] as String);

Map<String, dynamic> _$VenuesModelToJson(_VenuesModel instance) =>
    <String, dynamic>{'id': instance.id, 'name': instance.name};



FICHIER: flutter_lib/features/venues/data/repositories/venues_repository_impl.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import '../../domain/entities/venues_entity.dart';
import '../../domain/repositories/venues_repository.dart';
import '../datasources/venues_remote_data_source.dart';

part 'venues_repository_impl.g.dart';

@riverpod
VenuesRepository venuesRepository(Ref ref) {
  final remoteDataSource = ref.watch(venuesRemoteDataSourceProvider);
  return VenuesRepositoryImpl(remoteDataSource);
}

class VenuesRepositoryImpl implements VenuesRepository {
  final VenuesRemoteDataSource _remoteDataSource;

  VenuesRepositoryImpl(this._remoteDataSource);

  @override
  Future<List<VenuesEntity>> getVenuess() async {
    final models = await _remoteDataSource.fetchVenuess();
    return models.map((e) => e.toEntity()).toList();
  }

  @override
  Future<VenuesEntity> getVenues(String id) async {
    final model = await _remoteDataSource.fetchVenues(id);
    return model.toEntity();
  }
}



FICHIER: flutter_lib/features/venues/data/repositories/venues_repository_impl.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'venues_repository_impl.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(venuesRepository)
final venuesRepositoryProvider = VenuesRepositoryProvider._();

final class VenuesRepositoryProvider
    extends
        $FunctionalProvider<
          VenuesRepository,
          VenuesRepository,
          VenuesRepository
        >
    with $Provider<VenuesRepository> {
  VenuesRepositoryProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'venuesRepositoryProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$venuesRepositoryHash();

  @$internal
  @override
  $ProviderElement<VenuesRepository> $createElement($ProviderPointer pointer) =>
      $ProviderElement(pointer);

  @override
  VenuesRepository create(Ref ref) {
    return venuesRepository(ref);
  }

  /// {@macro riverpod.override_with_value}
  Override overrideWithValue(VenuesRepository value) {
    return $ProviderOverride(
      origin: this,
      providerOverride: $SyncValueProvider<VenuesRepository>(value),
    );
  }
}

String _$venuesRepositoryHash() => r'955ae296e3ec7371336fe0c1b64a9ea6bb687cc9';



FICHIER: flutter_lib/features/venues/domain/entities/venues_entity.dart
--------------------------------------------------------------------------------
import 'package:freezed_annotation/freezed_annotation.dart';

part 'venues_entity.freezed.dart';

@freezed
abstract class VenuesEntity with _$VenuesEntity {
  const factory VenuesEntity({
    required String id,
    required String name,
  }) = _VenuesEntity;
}



FICHIER: flutter_lib/features/venues/domain/entities/venues_entity.freezed.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND
// coverage:ignore-file
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'venues_entity.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

// dart format off
T _$identity<T>(T value) => value;
/// @nodoc
mixin _$VenuesEntity {

 String get id; String get name;
/// Create a copy of VenuesEntity
/// with the given fields replaced by the non-null parameter values.
@JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
$VenuesEntityCopyWith<VenuesEntity> get copyWith => _$VenuesEntityCopyWithImpl<VenuesEntity>(this as VenuesEntity, _$identity);



@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is VenuesEntity&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}


@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'VenuesEntity(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class $VenuesEntityCopyWith<$Res>  {
  factory $VenuesEntityCopyWith(VenuesEntity value, $Res Function(VenuesEntity) _then) = _$VenuesEntityCopyWithImpl;
@useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class _$VenuesEntityCopyWithImpl<$Res>
    implements $VenuesEntityCopyWith<$Res> {
  _$VenuesEntityCopyWithImpl(this._self, this._then);

  final VenuesEntity _self;
  final $Res Function(VenuesEntity) _then;

/// Create a copy of VenuesEntity
/// with the given fields replaced by the non-null parameter values.
@pragma('vm:prefer-inline') @override $Res call({Object? id = null,Object? name = null,}) {
  return _then(_self.copyWith(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}

}


/// Adds pattern-matching-related methods to [VenuesEntity].
extension VenuesEntityPatterns on VenuesEntity {
/// A variant of `map` that fallback to returning `orElse`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeMap<TResult extends Object?>(TResult Function( _VenuesEntity value)?  $default,{required TResult orElse(),}){
final _that = this;
switch (_that) {
case _VenuesEntity() when $default != null:
return $default(_that);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// Callbacks receives the raw object, upcasted.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case final Subclass2 value:
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult map<TResult extends Object?>(TResult Function( _VenuesEntity value)  $default,){
final _that = this;
switch (_that) {
case _VenuesEntity():
return $default(_that);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `map` that fallback to returning `null`.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case final Subclass value:
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? mapOrNull<TResult extends Object?>(TResult? Function( _VenuesEntity value)?  $default,){
final _that = this;
switch (_that) {
case _VenuesEntity() when $default != null:
return $default(_that);case _:
  return null;

}
}
/// A variant of `when` that fallback to an `orElse` callback.
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return orElse();
/// }
/// ```

@optionalTypeArgs TResult maybeWhen<TResult extends Object?>(TResult Function( String id,  String name)?  $default,{required TResult orElse(),}) {final _that = this;
switch (_that) {
case _VenuesEntity() when $default != null:
return $default(_that.id,_that.name);case _:
  return orElse();

}
}
/// A `switch`-like method, using callbacks.
///
/// As opposed to `map`, this offers destructuring.
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case Subclass2(:final field2):
///     return ...;
/// }
/// ```

@optionalTypeArgs TResult when<TResult extends Object?>(TResult Function( String id,  String name)  $default,) {final _that = this;
switch (_that) {
case _VenuesEntity():
return $default(_that.id,_that.name);case _:
  throw StateError('Unexpected subclass');

}
}
/// A variant of `when` that fallback to returning `null`
///
/// It is equivalent to doing:
/// ```dart
/// switch (sealedClass) {
///   case Subclass(:final field):
///     return ...;
///   case _:
///     return null;
/// }
/// ```

@optionalTypeArgs TResult? whenOrNull<TResult extends Object?>(TResult? Function( String id,  String name)?  $default,) {final _that = this;
switch (_that) {
case _VenuesEntity() when $default != null:
return $default(_that.id,_that.name);case _:
  return null;

}
}

}

/// @nodoc


class _VenuesEntity implements VenuesEntity {
  const _VenuesEntity({required this.id, required this.name});


@override final  String id;
@override final  String name;

/// Create a copy of VenuesEntity
/// with the given fields replaced by the non-null parameter values.
@override @JsonKey(includeFromJson: false, includeToJson: false)
@pragma('vm:prefer-inline')
_$VenuesEntityCopyWith<_VenuesEntity> get copyWith => __$VenuesEntityCopyWithImpl<_VenuesEntity>(this, _$identity);



@override
bool operator ==(Object other) {
  return identical(this, other) || (other.runtimeType == runtimeType&&other is _VenuesEntity&&(identical(other.id, id) || other.id == id)&&(identical(other.name, name) || other.name == name));
}


@override
int get hashCode => Object.hash(runtimeType,id,name);

@override
String toString() {
  return 'VenuesEntity(id: $id, name: $name)';
}


}

/// @nodoc
abstract mixin class _$VenuesEntityCopyWith<$Res> implements $VenuesEntityCopyWith<$Res> {
  factory _$VenuesEntityCopyWith(_VenuesEntity value, $Res Function(_VenuesEntity) _then) = __$VenuesEntityCopyWithImpl;
@override @useResult
$Res call({
 String id, String name
});




}
/// @nodoc
class __$VenuesEntityCopyWithImpl<$Res>
    implements _$VenuesEntityCopyWith<$Res> {
  __$VenuesEntityCopyWithImpl(this._self, this._then);

  final _VenuesEntity _self;
  final $Res Function(_VenuesEntity) _then;

/// Create a copy of VenuesEntity
/// with the given fields replaced by the non-null parameter values.
@override @pragma('vm:prefer-inline') $Res call({Object? id = null,Object? name = null,}) {
  return _then(_VenuesEntity(
id: null == id ? _self.id : id // ignore: cast_nullable_to_non_nullable
as String,name: null == name ? _self.name : name // ignore: cast_nullable_to_non_nullable
as String,
  ));
}


}

// dart format on



FICHIER: flutter_lib/features/venues/domain/repositories/venues_repository.dart
--------------------------------------------------------------------------------
import '../entities/venues_entity.dart';

abstract class VenuesRepository {
  Future<List<VenuesEntity>> getVenuess();
  Future<VenuesEntity> getVenues(String id);
}



FICHIER: flutter_lib/features/venues/domain/usecases/get_venuess_usecase.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import '../entities/venues_entity.dart';
import '../repositories/venues_repository.dart';
import '../../data/repositories/venues_repository_impl.dart';

part 'get_venuess_usecase.g.dart';

@riverpod
Future<List<VenuesEntity>> getVenuess(Ref ref) {
  return ref.watch(venuesRepositoryProvider).getVenuess();
}



FICHIER: flutter_lib/features/venues/domain/usecases/get_venuess_usecase.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'get_venuess_usecase.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(getVenuess)
final getVenuessProvider = GetVenuessProvider._();

final class GetVenuessProvider
    extends
        $FunctionalProvider<
          AsyncValue<List<VenuesEntity>>,
          List<VenuesEntity>,
          FutureOr<List<VenuesEntity>>
        >
    with
        $FutureModifier<List<VenuesEntity>>,
        $FutureProvider<List<VenuesEntity>> {
  GetVenuessProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'getVenuessProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$getVenuessHash();

  @$internal
  @override
  $FutureProviderElement<List<VenuesEntity>> $createElement(
    $ProviderPointer pointer,
  ) => $FutureProviderElement(pointer);

  @override
  FutureOr<List<VenuesEntity>> create(Ref ref) {
    return getVenuess(ref);
  }
}

String _$getVenuessHash() => r'6b2a6082f558f080b70226dcebd34eb82d08e689';



FICHIER: flutter_lib/features/venues/presentation/controllers/venues_controller.dart
--------------------------------------------------------------------------------
import 'package:riverpod_annotation/riverpod_annotation.dart';
import '../../domain/entities/venues_entity.dart';
import '../../domain/usecases/get_venuess_usecase.dart';

part 'venues_controller.g.dart';

@riverpod
class VenuesController extends _$VenuesController {
  @override
  FutureOr<List<VenuesEntity>> build() {
    return ref.watch(getVenuessProvider.future);
  }

  Future<void> refresh() async {
     state = const AsyncValue.loading();
     state = await AsyncValue.guard(() => ref.refresh(getVenuessProvider.future));
  }
}



FICHIER: flutter_lib/features/venues/presentation/controllers/venues_controller.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'venues_controller.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(VenuesController)
final venuesControllerProvider = VenuesControllerProvider._();

final class VenuesControllerProvider
    extends $AsyncNotifierProvider<VenuesController, List<VenuesEntity>> {
  VenuesControllerProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'venuesControllerProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$venuesControllerHash();

  @$internal
  @override
  VenuesController create() => VenuesController();
}

String _$venuesControllerHash() => r'18c03a10919a21dceb170a8eebf95b929dcd9744';

abstract class _$VenuesController extends $AsyncNotifier<List<VenuesEntity>> {
  FutureOr<List<VenuesEntity>> build();
  @$mustCallSuper
  @override
  void runBuild() {
    final ref =
        this.ref as $Ref<AsyncValue<List<VenuesEntity>>, List<VenuesEntity>>;
    final element =
        ref.element
            as $ClassProviderElement<
              AnyNotifier<AsyncValue<List<VenuesEntity>>, List<VenuesEntity>>,
              AsyncValue<List<VenuesEntity>>,
              Object?,
              Object?
            >;
    element.handleCreate(ref, build);
  }
}



FICHIER: flutter_lib/features/venues/presentation/screens/venues_screen.dart
--------------------------------------------------------------------------------
// features/venues/presentation/screens/venues_screen.dart

import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:livekit_client/livekit_client.dart';
import '../../../../providers/auth_provider.dart';

class VenuesScreen extends ConsumerStatefulWidget {
  const VenuesScreen({super.key});

  @override
  ConsumerState<VenuesScreen> createState() => _VenuesScreenState();
}

class _VenuesScreenState extends ConsumerState<VenuesScreen> {

  // M√©thode pour g√©rer la d√©connexion
  Future<void> _handleLogout(BuildContext context) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        backgroundColor: const Color(0xFF1E1E3F),
        title: const Text(
          'D√©connexion',
          style: TextStyle(color: Colors.white),
        ),
        content: const Text(
          'Voulez-vous vraiment vous d√©connecter ?',
          style: TextStyle(color: Colors.white70),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text(
              'Annuler',
              style: TextStyle(color: Colors.white70),
            ),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: const Color(0xFF6366F1),
            ),
            child: const Text('D√©connexion'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      await ref.read(authServiceProvider).signOut();
      if (context.mounted) {
        // Redirection vers la page de login social
        context.go('/login');
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    const backgroundColor = Color(0xFF0F0F23);
    const primaryColor = Color(0xFF6366F1);
    const textPrimary = Colors.white;

    return Scaffold(
      backgroundColor: backgroundColor,
      appBar: AppBar(
        backgroundColor: Colors.transparent,
        elevation: 0,
        // Bouton de d√©connexion √† gauche
        leading: IconButton(
          icon: const Icon(Icons.logout, color: textPrimary),
          onPressed: () => _handleLogout(context),
          tooltip: 'Se d√©connecter',
        ),
        title: Text(
          'Nos Bars Virtuels',
          style: TextStyle(
            color: textPrimary,
            fontSize: 24,
            fontWeight: FontWeight.bold,
          ),
        ),
        centerTitle: true,
        // Bouton de compte (roue crant√©e) √† droite
        actions: [
          IconButton(
            icon: const Icon(Icons.settings, color: textPrimary),
            onPressed: () {
              // Navigation vers l'espace compte
              context.go('/account');
            },
            tooltip: 'Mon compte',
          ),
        ],
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Message de bienvenue
            Padding(
              padding: const EdgeInsets.symmetric(vertical: 16),
              child: Text(
                'Choisissez votre ambiance',
                style: TextStyle(
                  color: textPrimary,
                  fontSize: 18,
                  fontWeight: FontWeight.w600,
                ),
              ),
            ),

            // Liste des bars virtuels
            Expanded(
              child: GridView.builder(
                gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: 2,
                  crossAxisSpacing: 16,
                  mainAxisSpacing: 16,
                  childAspectRatio: 0.8,
                ),
                itemCount: _venues.length,
                itemBuilder: (context, index) {
                  final venue = _venues[index];
                  return _buildVenueCard(venue, primaryColor, backgroundColor, textPrimary);
                },
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildVenueCard(Map<String, dynamic> venue, Color primaryColor, Color backgroundColor, Color textPrimary) {
    return Card(
      elevation: 4,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(16),
      ),
      color: backgroundColor,
      child: InkWell(
        onTap: () {
          // Navigation vers l'√©cran des tables avec GoRouter
          final venueId = venue['id'] ?? 'default'; // Assurez-vous d'avoir un ID
          context.go('/venues/$venueId/tables');
        },
        borderRadius: BorderRadius.circular(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Image du bar
            Container(
              height: 120,
              decoration: BoxDecoration(
                borderRadius: const BorderRadius.only(
                  topLeft: Radius.circular(16),
                  topRight: Radius.circular(16),
                ),
                image: DecorationImage(
                  image: AssetImage(venue['image']),
                  fit: BoxFit.cover,
                ),
              ),
              child: Container(
                decoration: BoxDecoration(
                  borderRadius: const BorderRadius.only(
                    topLeft: Radius.circular(16),
                    topRight: Radius.circular(16),
                  ),
                  gradient: LinearGradient(
                    begin: Alignment.topCenter,
                    end: Alignment.bottomCenter,
                    colors: [
                      Colors.transparent,
                      Colors.black.withOpacity(0.6),
                    ],
                  ),
                ),
                alignment: Alignment.bottomLeft,
                padding: const EdgeInsets.all(12),
                child: Text(
                  venue['name'],
                  style: const TextStyle(
                    color: Colors.white,
                    fontSize: 16,
                    fontWeight: FontWeight.bold,
                  ),
                ),
              ),
            ),

            // Informations
            Padding(
              padding: const EdgeInsets.all(12),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    venue['description'],
                    style: TextStyle(
                      color: textPrimary.withOpacity(0.8),
                      fontSize: 12,
                    ),
                    maxLines: 2,
                    overflow: TextOverflow.ellipsis,
                  ),
                  const SizedBox(height: 8),

                  // Nombre de personnes connect√©es (optionnel)
                  // Row(
                  //   children: [
                  //     Icon(
                  //       Icons.group,
                  //       color: primaryColor,
                  //       size: 16,
                  //     ),
                  //     const SizedBox(width: 4),
                  //     Text(
                  //       '${venue['activeUsers']} personnes',
                  //       style: TextStyle(
                  //         color: textPrimary.withOpacity(0.6),
                  //         fontSize: 12,
                  //       ),
                  //     ),
                  //   ],
                  // ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }

  final List<Map<String, dynamic>> _venues = [
    {
      'id': 'lounge',
      'name': 'Le Lounge √âtoil√©',
      'description': 'Ambiance lounge avec vue sur les √©toiles',
      'image': 'assets/images/venues/lounge.png',
      'activeUsers': 24,
    },
    {
      'id': 'port',
      'name': 'Le Bar du Port',
      'description': 'Son des vagues et cocktails fruit√©s',
      'image': 'assets/images/venues/port.png',
      'activeUsers': 18,
    },
    {
      'id': 'rooftop',
      'name': 'Le Rooftop Urbain',
      'description': 'Vue panoramique sur la skyline',
      'image': 'assets/images/venues/rooftop.png',
      'activeUsers': 32,
    },
    {
      'id': 'jazz',
      'name': 'La Cave Jazz',
      'description': 'Ambiance intime et musique live',
      'image': 'assets/images/venues/jazz.png',
      'activeUsers': 12,
    },
    {
      'id': 'garden',
      'name': 'Le Garden Tropical',
      'description': 'Jardin virtuel avec cocktails exotiques',
      'image': 'assets/images/venues/garden.png',
      'activeUsers': 28,
    },
    {
      'id': 'club',
      'name': 'Le Club Priv√©',
      'description': 'Acc√®s exclusif, ambiance feutr√©e',
      'image': 'assets/images/venues/club.png',
      'activeUsers': 8,
    },
  ];
}


FICHIER: flutter_lib/providers/auth_provider.dart
--------------------------------------------------------------------------------
import 'package:dio/dio.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_riverpod/legacy.dart';

import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import 'package:google_sign_in/google_sign_in.dart';
import '../services/api_service.dart';
import '../services/auth_service.dart';

// Provider pour ApiService
final apiServiceProvider = Provider<ApiService>((ref) {
  final dio = Dio();
  final storage = const FlutterSecureStorage();
  return ApiService(dio: dio, storage: storage);
});

// Provider pour AuthService
final authServiceProvider = Provider<AuthService>((ref) {
  final apiService = ref.watch(apiServiceProvider);
  return AuthService(
    onAuthenticationEvent: (event) async {
      print('Authentication event: $event');
    },
    onAuthenticationError: (error) async {
      print('Authentication error: $error');
    },
    apiService: apiService,
  );
});

// Stream provider pour les changements d'√©tat Firebase
final authStateProvider = StreamProvider<User?>((ref) {
  final authService = ref.watch(authServiceProvider);
  return authService.authStateChanges;
});

// Provider pour l'utilisateur courant Firebase
final currentUserProvider = Provider<User?>((ref) {
  return ref.watch(authServiceProvider).currentUser;
});

// Provider pour r√©cup√©rer le JWT applicatif (version FutureProvider)
final appJwtProvider = FutureProvider<String?>((ref) async {
  final authService = ref.watch(authServiceProvider);
  return await authService.getAppJwt();
});

// ============================================================
// NOUVEAUX PROVIDERS POUR LA GESTION COMPL√àTE DE L'AUTH
// ============================================================

// Enum pour les diff√©rents statuts d'authentification
enum AuthStatus {
  initial,           // Non connect√©
  authenticated,     // Firebase OK mais JWT en cours
  fullyAuthenticated, // Firebase + JWT OK
  error,             // Erreur
}

// Classe repr√©sentant l'√©tat d'authentification complet
class AuthState {
  final AuthStatus status;
  final User? user;
  final String? jwtToken;
  final Object? error;

  const AuthState({
    required this.status,
    this.user,
    this.jwtToken,
    this.error,
  });

  // ‚ö†Ô∏è CORRECTION ICI : Ce ne sont plus des factory constructors
  // Ce sont des constructors nomm√©s qui retournent une nouvelle instance

  static const AuthState initial = AuthState(status: AuthStatus.initial);

  const AuthState.authenticated(User user) : this(
    status: AuthStatus.authenticated,
    user: user,
  );

  const AuthState.fullyAuthenticated({
    required User user,
    required String jwtToken,
  }) : this(
    status: AuthStatus.fullyAuthenticated,
    user: user,
    jwtToken: jwtToken,
  );

  const AuthState.error(Object error) : this(
    status: AuthStatus.error,
    error: error,
  );

  // M√©thodes utilitaires
  bool get isFullyAuthenticated => status == AuthStatus.fullyAuthenticated;
  bool get isAuthenticated => status == AuthStatus.authenticated || status == AuthStatus.fullyAuthenticated;
  bool get isInitial => status == AuthStatus.initial;
  bool get hasError => status == AuthStatus.error;

  // M√©thode copyWith pour faciliter les mises √† jour
  AuthState copyWith({
    AuthStatus? status,
    User? user,
    String? jwtToken,
    Object? error,
  }) {
    return AuthState(
      status: status ?? this.status,
      user: user ?? this.user,
      jwtToken: jwtToken ?? this.jwtToken,
      error: error ?? this.error,
    );
  }

  @override
  String toString() {
    return 'AuthState(status: $status, user: ${user?.uid}, hasJwt: ${jwtToken != null})';
  }
}

// StateNotifier pour g√©rer l'√©tat d'authentification complet
class AuthStateNotifier extends StateNotifier<AuthState> {
  final AuthService _authService;
  final Ref _ref;

  AuthStateNotifier({
    required AuthService authService,
    required Ref ref,
  }) : _authService = authService,
        _ref = ref,
        super(AuthState.initial) {  // ‚ö†Ô∏è CORRECTION ICI : AuthState.initial (sans parenth√®ses)
    _init();
  }

  Future<void> _init() async {
    // √âcouter les changements d'authentification Firebase
    _ref.listen(authStateProvider, (previous, next) {
      next.whenData((user) async {
        if (user != null) {
          // Utilisateur Firebase connect√©
          state = AuthState.authenticated(user);

          // V√©rifier si on a d√©j√† un JWT
          try {
            final existingJwt = await _authService.getAppJwt();
            if (existingJwt != null && existingJwt.isNotEmpty) {
              // JWT d√©j√† pr√©sent
              state = AuthState.fullyAuthenticated(
                user: user,
                jwtToken: existingJwt,
              );
              print('‚úÖ JWT d√©j√† pr√©sent dans le stockage');
            } else {
              print('‚è≥ En attente du JWT applicatif...');
            }
          } catch (e) {
            print('‚ùå Erreur lors de la v√©rification du JWT: $e');
          }
        } else {
          // D√©connect√©
          state = AuthState.initial;  // ‚ö†Ô∏è CORRECTION ICI : AuthState.initial (sans parenth√®ses)
          print('üë§ Utilisateur d√©connect√©');
        }
      });
    });

    // √âcouter les √©v√©nements d'authentification pour capturer le JWT
    _authService.onAuthenticationEvent = (event) async {
      if (event is GoogleSignInAuthenticationEventSignIn) {
        print('üì° √âv√©nement d\'authentification re√ßu, attente du JWT...');

        // Attendre que le JWT soit stock√© (avec timeout)
        const maxAttempts = 10;
        var attempts = 0;
        String? jwt;

        while (attempts < maxAttempts) {
          await Future.delayed(const Duration(milliseconds: 300));
          jwt = await _authService.getAppJwt();
          if (jwt != null && jwt.isNotEmpty) {
            break;
          }
          attempts++;
        }

        final user = _authService.currentUser;

        if (jwt != null && jwt.isNotEmpty && user != null) {
          state = AuthState.fullyAuthenticated(
            user: user,
            jwtToken: jwt,
          );
          print('‚úÖ Authentification compl√®te (Firebase + JWT)');
        } else if (user != null) {
          // Firebase OK mais pas de JWT
          state = AuthState.authenticated(user);
          print('‚ö†Ô∏è Firebase authentifi√© mais JWT manquant');
        }
      }
    };

    // √âcouter les erreurs d'authentification
    _authService.onAuthenticationError = (error) async {
      state = AuthState.error(error);
      print('‚ùå Erreur d\'authentification: $error');
    };
  }

  // M√©thode pour r√©initialiser manuellement l'√©tat
  void reset() {
    state = AuthState.initial;  // ‚ö†Ô∏è CORRECTION ICI : AuthState.initial (sans parenth√®ses)
  }

  // M√©thode pour forcer une erreur
  void setError(Object error) {
    state = AuthState.error(error);
  }

  // M√©thode pour rafra√Æchir le JWT (si n√©cessaire)
  /*
  Future<bool> refreshJwt() async {
    try {
      final user = _authService.currentUser;
      if (user == null) {
        return false;
      }

      // R√©cup√©rer un nouveau token Firebase
      final tokenResult = await user.getIdTokenResult(true);
      if (tokenResult.token == null) {
        return false;
      }

      // Appeler l'API pour obtenir un nouveau JWT
      final newJwt = await _authService.refreshJwtFromApi(tokenResult.token!);

      if (newJwt != null && newJwt.isNotEmpty) {
        state = state.copyWith(
          jwtToken: newJwt,
          status: AuthStatus.fullyAuthenticated,
        );
        return true;
      }
      return false;
    } catch (e) {
      setError(e);
      return false;
    }
  }

   */
}

// StateNotifierProvider
final authStateNotifierProvider = StateNotifierProvider<AuthStateNotifier, AuthState>((ref) {
  final authService = ref.watch(authServiceProvider);
  return AuthStateNotifier(
    authService: authService,
    ref: ref,
  );
});

// Providers utilitaires pour faciliter l'acc√®s √† l'√©tat

// Provider pour savoir si l'utilisateur est compl√®tement authentifi√©
final isFullyAuthenticatedProvider = Provider<bool>((ref) {
  final authState = ref.watch(authStateNotifierProvider);
  return authState.isFullyAuthenticated;
});

// Provider pour r√©cup√©rer le JWT de mani√®re synchrone (si disponible)
final appJwtSyncProvider = Provider<String?>((ref) {
  final authState = ref.watch(authStateNotifierProvider);
  return authState.jwtToken;
});

// Provider pour r√©cup√©rer l'utilisateur de mani√®re synchrone
final currentUserSyncProvider = Provider<User?>((ref) {
  final authState = ref.watch(authStateNotifierProvider);
  return authState.user;
});

// Provider pour v√©rifier si l'authentification est en cours
final isAuthenticatingProvider = Provider<bool>((ref) {
  final authState = ref.watch(authStateNotifierProvider);
  return authState.status == AuthStatus.authenticated;
});

// Provider pour obtenir le message d'erreur (si pr√©sent)
final authErrorProvider = Provider<Object?>((ref) {
  final authState = ref.watch(authStateNotifierProvider);
  return authState.error;
});


FICHIER: flutter_lib/providers/test_state_notifier.dart
--------------------------------------------------------------------------------
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_riverpod/legacy.dart';

// Test simple
class TestNotifier extends StateNotifier<int> {
  TestNotifier() : super(0);
}

final testProvider = StateNotifierProvider<TestNotifier, int>((ref) {
  return TestNotifier();
});

void main() {
  print('‚úÖ Si ce fichier compile, StateNotifier est disponible');
}


FICHIER: flutter_lib/services/api_service.dart
--------------------------------------------------------------------------------
import 'package:dio/dio.dart';
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';

part 'api_service.g.dart';

class ApiException implements Exception {
  final String message;
  final int? statusCode;
  final dynamic originalError;

  ApiException({
    required this.message,
    this.statusCode,
    this.originalError,
  });

  @override
  String toString() => 'ApiException: $message (Status: $statusCode)';
}

class ApiService {
  final Dio _dio;
  final FlutterSecureStorage _storage;
  static const _baseUrl = 'http://192.168.1.56:8101/api';

  ApiService({
    required Dio dio,
    required FlutterSecureStorage storage,
  })  : _dio = dio,
        _storage = storage {
    _dio.options.baseUrl = _baseUrl;
    _dio.options.headers['Content-Type'] = 'application/json';
    _dio.options.connectTimeout = const Duration(seconds: 10);
    _dio.options.receiveTimeout = const Duration(seconds: 10);

    _dio.interceptors
        .add(LogInterceptor(requestBody: true, responseBody: true));
  }





  // M√©thode g√©n√©rique pour g√©rer les requ√™tes avec gestion d'erreur centralis√©e
  Future<T> safeApiCall<T>({
    required Future<T> Function() apiCall,
    String? errorMessage,
  }) async {
    try {
      return await apiCall();
    } on DioException catch (e) {
      throw _handleDioError(e, errorMessage);
    } catch (e) {
      throw ApiException(
        message: errorMessage ?? 'Une erreur inattendue est survenue',
        originalError: e,
      );
    }
  }

  ApiException _handleDioError(DioException e, String? customMessage) {
    String message;
    int? statusCode = e.response?.statusCode;

    switch (e.type) {
      case DioExceptionType.connectionTimeout:
      case DioExceptionType.sendTimeout:
      case DioExceptionType.receiveTimeout:
        message = 'D√©lai de connexion d√©pass√©';
        break;
      case DioExceptionType.badResponse:
        message = _parseErrorResponse(e.response);
        break;
      case DioExceptionType.cancel:
        message = 'Requ√™te annul√©e';
        break;
      case DioExceptionType.connectionError:
        message = 'Erreur de connexion r√©seau';
        break;
      default:
        message = customMessage ?? 'Erreur r√©seau inconnue';
    }

    return ApiException(
      message: message,
      statusCode: statusCode,
      originalError: e,
    );
  }

  String _parseErrorResponse(Response? response) {
    try {
      if (response?.data != null && response!.data is Map) {
        return response.data['message'] ??
            response.data['error'] ??
            'Erreur serveur (${response.statusCode})';
      }
      return 'Erreur serveur (${response?.statusCode ?? 'inconnue'})';
    } catch (_) {
      return 'Erreur serveur inconnue';
    }
  }

  // M√©thodes API sp√©cifiques
  Future<String> getJwtFromFirebaseToken(String firebaseToken) async {
    return safeApiCall(
      apiCall: () async {
        final response = await _dio.post(
          '/users/jwt-by-firebase-token',
          data: {'token': firebaseToken},
        );

        if (response.statusCode == 200) {
          // Adapter selon le format de r√©ponse de votre API
          // Supposons que l'API retourne { "jwt": "token_value" }
          final jwt = response.data['jwt'] ?? response.data['token'] ?? response.data;
          if (jwt == null) {
            throw ApiException(message: 'Format de r√©ponse API invalide');
          }
          return jwt.toString();
        } else {
          throw ApiException(
            message: 'Erreur lors de la r√©cup√©ration du JWT',
            statusCode: response.statusCode,
          );
        }
      },
      errorMessage: 'Impossible de r√©cup√©rer le token JWT',
    );
  }

// Nouvelle m√©thode pour g√©n√©rer le token LiveKit
  Future<Map<String, dynamic>> generateLiveKitToken({
    required String participantIdentity,
    required String participantName,
    required String roomName,
    String participantMetadata = '',
    Map<String, dynamic> participantAttributes = const {},
    Map<String, dynamic> roomConfig = const {},
  }) async {
    return safeApiCall(
      apiCall: () async {
        final payload = {
          "participant_identity": participantIdentity,
          "participant_name": participantName,
          "participant_metadata": participantMetadata,
          "participant_attributes": participantAttributes,
          "room_name": roomName,
          "room_config": roomConfig
        };

        // R√©cup√©rer le JWT pour l'authentification
        final appJwt = await _storage.read(key: 'app_jwt_token');

        if (appJwt == null) {
          throw ApiException(message: 'JWT token non disponible');
        }

        final response = await _dio.post(
          '/sfu/generate-token', // Note: plus besoin de l'URL compl√®te, baseUrl est d√©j√† configur√©e
          data: payload,
          options: Options(
            headers: {
              'Authorization': 'Bearer $appJwt',
            },
          ),
        );

        if (response.statusCode == 200) {
          return response.data as Map<String, dynamic>;
        } else {
          throw ApiException(
            message: 'Erreur lors de la g√©n√©ration du token LiveKit',
            statusCode: response.statusCode,
          );
        }
      },
      errorMessage: 'Impossible de g√©n√©rer le token LiveKit',
    );
  }
}

@riverpod
ApiService apiService(Ref ref) {
  final dio = Dio(); // √Ä configurer selon vos besoins
  final storage = const FlutterSecureStorage();
  return ApiService(dio: dio, storage: storage);
}


FICHIER: flutter_lib/services/api_service.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'api_service.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(apiService)
final apiServiceProvider = ApiServiceProvider._();

final class ApiServiceProvider
    extends $FunctionalProvider<ApiService, ApiService, ApiService>
    with $Provider<ApiService> {
  ApiServiceProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'apiServiceProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$apiServiceHash();

  @$internal
  @override
  $ProviderElement<ApiService> $createElement($ProviderPointer pointer) =>
      $ProviderElement(pointer);

  @override
  ApiService create(Ref ref) {
    return apiService(ref);
  }

  /// {@macro riverpod.override_with_value}
  Override overrideWithValue(ApiService value) {
    return $ProviderOverride(
      origin: this,
      providerOverride: $SyncValueProvider<ApiService>(value),
    );
  }
}

String _$apiServiceHash() => r'eb9a66cc54e1c15d5870b8da260d4ea1f6b053ac';



FICHIER: flutter_lib/services/auth_service.dart
--------------------------------------------------------------------------------
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import 'package:google_sign_in/google_sign_in.dart';
import 'api_service.dart'; // Ajout de l'import

class AuthService {
  final FirebaseAuth _firebaseAuth = FirebaseAuth.instance;
  final ApiService _apiService; // Ajout du service API

  // Instance du stockage s√©curis√©
  final _storage = const FlutterSecureStorage();

  // Cl√© pour le stockage
  static const _tokenKey = 'firebase_id_token';
  static const _appJwtKey = 'app_jwt_token'; // Nouvelle cl√© pour le JWT applicatif
  static const _userIdentityKey = 'connected_user_identity';
  static const _userDisplayNameKey = 'connected_user_displayname';

  // Callbacks inject√©s
  Future<void> Function(GoogleSignInAuthenticationEvent)? onAuthenticationEvent;
  Future<void> Function(Object)? onAuthenticationError;

  AuthService({
    this.onAuthenticationEvent,
    this.onAuthenticationError,
    required ApiService apiService, // Ajout du param√®tre
  }) : _apiService = apiService;

  // Get current user
  User? get currentUser => _firebaseAuth.currentUser;

  // Stream pour √©couter les changements d'authentification
  Stream<User?> get authStateChanges => _firebaseAuth.authStateChanges();

  bool _isSignInInitialized = false;

  // GOOGLE SIGNIN
  String? clientId;
  String? serverClientId = '1084343369802-36565dmgarm2gkos54eb6j9q6so0s9bf.apps.googleusercontent.com';
  List<String> scopes = <String>[
    'https://www.googleapis.com/auth/userinfo.email',
    'https://www.googleapis.com/auth/userinfo.profile',
  ];
  final GoogleSignIn signIn = GoogleSignIn.instance;

  Future<void> _handleAuthenticationEvent(GoogleSignInAuthenticationEvent event) async {
    final GoogleSignInAccount? user = switch (event) {
      GoogleSignInAuthenticationEventSignIn() => event.user,
      GoogleSignInAuthenticationEventSignOut() => null,
    };

    final GoogleSignInClientAuthorization? authorization = await user?.authorizationClient.authorizationForScopes(scopes);

    if (user != null && authorization != null) {
      print(user);
      print("===== user =======");

      try {
        final OAuthCredential googleCredential = GoogleAuthProvider.credential(
          accessToken: authorization.accessToken,
          idToken: user.authentication.idToken,
        );

        final UserCredential googleUserCredential = await FirebaseAuth.instance.signInWithCredential(googleCredential);

        IdTokenResult tokenResult = await FirebaseAuth.instance.currentUser!.getIdTokenResult();

        if (tokenResult.token != null) {
          // Stocker le token Firebase
          await _storage.write(key: _tokenKey, value: tokenResult.token);
          await _storage.write(key: _userIdentityKey, value: user.displayName);
          await _storage.write(key: _userDisplayNameKey, value: user.displayName);

          // NOUVEAU : Appeler l'API pour obtenir le JWT applicatif
          try {
            print('üîÑ R√©cup√©ration du JWT applicatif...');
            final appJwt = await _apiService.getJwtFromFirebaseToken(tokenResult.token!);

            // Stocker le JWT applicatif
            await _storage.write(key: _appJwtKey, value: appJwt);
            print('‚úÖ JWT applicatif r√©cup√©r√© et stock√©');

          } catch (e) {
            print('‚ùå Erreur lors de la r√©cup√©ration du JWT applicatif: $e');
            // Ne pas bloquer la connexion si l'API JWT √©choue ?
            // Selon votre logique m√©tier, vous pouvez choisir de rethrow ou non
            if (e is ApiException) {
              print('D√©tails API: ${e.message} (${e.statusCode})');
            }

            // Option 1: Laisser l'erreur remonter (d√©commentez la ligne suivante)
            // rethrow;

            // Option 2: Continuer quand m√™me (actuellement choisi)
          }

          // Appeler le callback inject√© si pr√©sent
          if (onAuthenticationEvent != null) {
            await onAuthenticationEvent!(event);
          }

          print(tokenResult.token);
          print("====== tokenResult.token =======");
        }

      } catch (error) {
        print(error);
        print('error');

        // Appeler le callback d'erreur
        if (onAuthenticationError != null) {
          await onAuthenticationError!(error);
        }
      }
    }
  }

  // ... (le reste du code reste identique)

  Future<void> _handleAuthenticationError(Object e) async {
    print(e);

    if (onAuthenticationError != null) {
      await onAuthenticationError!(e);
    }
  }

  Future<void> initGoogleSignIn() async {
    if (_isSignInInitialized) return;

    _isSignInInitialized = true;

    await signIn.initialize(clientId: clientId, serverClientId: serverClientId).then((_) async {
      signIn.authenticationEvents.listen(_handleAuthenticationEvent).onError(_handleAuthenticationError);
    });
  }

  Future<User?> signInWithGoogle() async {
    await initGoogleSignIn();

    if (GoogleSignIn.instance.supportsAuthenticate()) {
      try {
        await GoogleSignIn.instance.authenticate();
      } catch (e) {
        print("Erreur Google Sign-In : $e");
      }
    }
  }

  // Nouvelle m√©thode pour r√©cup√©rer le JWT applicatif
  Future<String?> getAppJwt() async {
    return await _storage.read(key: _appJwtKey);
  }

  // M√©thode de d√©connexion am√©lior√©e
  Future<void> signOut() async {
    try {
      await _firebaseAuth.signOut();
      await GoogleSignIn.instance.signOut();

      // Nettoyer le stockage
      await _storage.delete(key: _tokenKey);
      await _storage.delete(key: _appJwtKey);
      await _storage.delete(key: _userIdentityKey);
      await _storage.delete(key: _userDisplayNameKey);

      print('‚úÖ D√©connexion r√©ussie');
    } catch (e) {
      print('‚ùå Erreur lors de la d√©connexion: $e');
      rethrow;
    }
  }

  bool isLoggedIn() {
    return _firebaseAuth.currentUser != null;
  }
}


FICHIER: flutter_lib/services/sfu_service.dart
--------------------------------------------------------------------------------
// Cr√©er un nouveau fichier: flutter_lib/features/tables/services/sfu_service.dart

import 'package:riverpod_annotation/riverpod_annotation.dart';
import '../../../services/api_service.dart';

part 'sfu_service.g.dart';

class SfuService {
  final ApiService _apiService;

  SfuService({required ApiService apiService}) : _apiService = apiService;

  Future<Map<String, dynamic>> generateToken({
    required String participantIdentity,
    required String participantName,
    required String roomName,
    String participantMetadata = '',
    Map<String, dynamic> participantAttributes = const {},
    Map<String, dynamic> roomConfig = const {},
  }) async {
    return _apiService.generateLiveKitToken(
      participantIdentity: participantIdentity,
      participantName: participantName,
      participantAttributes: participantAttributes,
      participantMetadata: participantMetadata,
      roomName: roomName,
      roomConfig: roomConfig,
    );
  }
}

@riverpod
SfuService sfuService(Ref ref) {
  final apiService = ref.watch(apiServiceProvider);
  return SfuService(apiService: apiService);
}


FICHIER: flutter_lib/services/sfu_service.g.dart
--------------------------------------------------------------------------------
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'sfu_service.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint, type=warning

@ProviderFor(sfuService)
final sfuServiceProvider = SfuServiceProvider._();

final class SfuServiceProvider
    extends $FunctionalProvider<SfuService, SfuService, SfuService>
    with $Provider<SfuService> {
  SfuServiceProvider._()
    : super(
        from: null,
        argument: null,
        retry: null,
        name: r'sfuServiceProvider',
        isAutoDispose: true,
        dependencies: null,
        $allTransitiveDependencies: null,
      );

  @override
  String debugGetCreateSourceHash() => _$sfuServiceHash();

  @$internal
  @override
  $ProviderElement<SfuService> $createElement($ProviderPointer pointer) =>
      $ProviderElement(pointer);

  @override
  SfuService create(Ref ref) {
    return sfuService(ref);
  }

  /// {@macro riverpod.override_with_value}
  Override overrideWithValue(SfuService value) {
    return $ProviderOverride(
      origin: this,
      providerOverride: $SyncValueProvider<SfuService>(value),
    );
  }
}

String _$sfuServiceHash() => r'eec97a26458eb6027d15e5c5845938b8e56f520d';



FIN
============
Total fichiers: 37